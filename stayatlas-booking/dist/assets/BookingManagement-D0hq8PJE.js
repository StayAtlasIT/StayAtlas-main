import{b as d,j as e,K as G,M as O,N as F,G as N,V as c}from"./index-CHayuJmP.js";function z(){const[a,_]=d.useState("all-bookings"),[n,x]=d.useState(1),[f,I]=d.useState(""),[o,b]=d.useState([]),[p,g]=d.useState(null);d.useEffect(()=>{async function t(){try{const s=await N.get("/v1/bookings");s.data.statusCode===200?b(s.data.data):c.error("Error fetching bookings")}catch(s){console.error("Error fetching bookings: ",s),c.error("Error fetching bookings")}}t()},[]),d.useEffect(()=>{function t(s){if(p===null)return;s.target.closest(`[data-menu-id="${p}"]`)||g(null)}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[p]);const w=o.filter(t=>{if(!f)return!0;const s=f.toLowerCase().split(" ").filter(Boolean),l=t.user||{},i=t.villa||{},r=[l.firstName||"",l.lastName||"",l.email||"",i.villaName||""].join(" ").toLowerCase();return s.every(y=>r.includes(y))}).filter(t=>a==="all-bookings"?!0:a==="confirmed-bookings"?t.status==="Confirmed":a==="completed"?t.status==="Completed":a==="pending-bookings"?t.status==="Pending":a==="cancelled-bookings"?t.status==="Cancelled":!1),j=20,v=(n-1)*j,D=v+j,k=w.slice(v,D),u=Math.max(1,Math.ceil(w.length/j)),m={total:o.length,confirmed:o.filter(t=>t.status==="Confirmed").length,pending:o.filter(t=>t.status==="Pending").length,cancelled:o.filter(t=>t.status==="Cancelled").length,completed:o.filter(t=>t.status==="Completed").length},h=t=>{_(t),x(1)},C=async(t,s)=>{if(t==="Approve")try{const l=await N.post(`/v1/admin/accept-user-booking/${s._id}`);console.log("Response: ",l),l.data.statusCode===200?(c.success("Booking approved successfully"),b(i=>i.map(r=>r._id===s._id?{...r,status:"Confirmed"}:r))):c.error("Error approving booking")}catch(l){console.error("Error approving booking: ",l),c.error("Error approving booking")}if(t==="Reject")try{(await N.post(`/v1/admin/reject-user-booking/${s._id}`)).data.statusCode===200?(c.success("Booking rejected successfully"),b(i=>i.map(r=>r._id===s._id?{...r,status:"Cancelled"}:r))):c.error("Error rejecting booking")}catch(l){console.error("Error rejecting booking: ",l),c.error("Error rejecting booking")}},P=(t,s)=>{alert(`${t} villa: ${s.name}`)},M=t=>{I(t.target.value),x(1)},R=()=>{n>1&&x(n-1)},T=()=>{const t=a==="villa-details"?totalVillaPages:u;n<t&&x(n+1)};return e.jsxs("div",{className:"bg-gray-100 min-h-screen",children:[e.jsx("div",{className:"mb-8 text-center",children:e.jsx("h1",{className:"text-2xl md:text-4xl font-extrabold text-green-700 tracking-tight",children:"Booking Management"})}),e.jsxs("div",{className:"max-w-8xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-2",children:"Total Bookings"}),e.jsx("div",{className:"text-3xl font-bold text-green-600",children:m.total})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-2",children:"Completed Bookings"}),e.jsx("div",{className:"text-3xl font-bold text-red-600",children:m.completed})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-2",children:"Confirmed Bookings"}),e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:m.confirmed})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-2",children:"Pending Bookings"}),e.jsx("div",{className:"text-3xl font-bold text-orange-600",children:m.pending})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-2",children:"Cancelled Bookings"}),e.jsx("div",{className:"text-3xl font-bold text-red-600",children:m.cancelled})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex border-b border-gray-200 mb-4",children:[e.jsx("button",{className:`py-2 px-4 font-medium ${a==="all-bookings"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500"}`,onClick:()=>h("all-bookings"),children:"All Bookings"}),e.jsx("button",{className:`py-2 px-4 font-medium ${a==="completed"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500"}`,onClick:()=>h("completed"),children:"Completed"}),e.jsx("button",{className:`py-2 px-4 font-medium ${a==="confirmed-bookings"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500"}`,onClick:()=>h("confirmed-bookings"),children:"Confirmed"}),e.jsx("button",{className:`py-2 px-4 font-medium ${a==="pending-bookings"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500"}`,onClick:()=>h("pending-bookings"),children:"Pending"}),e.jsx("button",{className:`py-2 px-4 font-medium ${a==="cancelled-bookings"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500"}`,onClick:()=>h("cancelled-bookings"),children:"Cancelled"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[a!=="villa-details"&&e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsx("input",{type:"text",placeholder:"Search by name, villa, or email...",className:"w-full max-w-md px-4 py-2 border border-gray-300 rounded-md",value:f,onChange:M})}),a!=="villa-details"?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Booking ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Guest Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Villa Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check-In"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Check-Out"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Guests"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone Number"}),a==="all-bookings"&&e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),a!=="completed"&&e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k.length>0?k.map(t=>{var s,l,i,r,y,E,B,$,A,S,V;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:`STAY${t._id.slice(-7)}`}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:`${(s=t==null?void 0:t.user)==null?void 0:s.firstName} ${(l=t==null?void 0:t.user)==null?void 0:l.lastName}`}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.villa?(i=t.villa)==null?void 0:i.villaName:"Villa not available"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(t.checkIn).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(t.checkOut).toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(r=t.totalAmount)==null?void 0:r.$numberDecimal}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:((y=t.guests)==null?void 0:y.adults)+((E=t.guests)==null?void 0:E.children)+((B=t.guests)==null?void 0:B.pets)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(($=t.user)==null?void 0:$.email)===""?"Not Provided":(A=t.user)==null?void 0:A.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(S=t.user)!=null&&S.phoneNumber?(V=t.user)==null?void 0:V.phoneNumber:"Not Provided"}),a==="all-bookings"&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                ${t.status==="Confirmed"?"bg-green-100 text-green-800":t.status==="Pending"?"bg-yellow-100 text-yellow-800":t.status==="Cancelled"?"bg-red-100 text-red-800":"bg-blue-500 text-gray-100"}`,children:t.status})}),a!=="completed"&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"relative inline-block text-left","data-menu-id":t._id,children:[e.jsxs("button",{onClick:()=>g(L=>L===t._id?null:t._id),className:"flex items-center bg-yellow-50 text-yellow-600 px-3 py-1 rounded-md mr-2 text-sm hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-yellow-300",children:["Actions",e.jsx(G,{className:"ml-1 h-4 w-4"})]}),p===t._id&&e.jsx("div",{className:"origin-top-right absolute right-0 mt-2 w-36 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-20",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>{C("Approve",t),g(null)},className:"flex items-center w-full px-4 py-2 text-sm text-green-600 hover:bg-green-50",children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Approve"]}),e.jsxs("button",{onClick:()=>{C("Reject",t),g(null)},className:"flex items-center w-full px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Reject"]})]})})]})})]},t._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:a==="all-bookings"?9:8,className:"px-6 py-10 text-center text-gray-500",children:"No bookings found for the current filter"})})})]})}):e.jsx("div",{className:"p-4",children:paginatedVillas.length>0?paginatedVillas.map(t=>e.jsxs("div",{className:"bg-white mb-6 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:t.name}),e.jsxs("div",{children:[e.jsx("button",{className:"bg-yellow-50 text-yellow-600 px-3 py-1 rounded-md mr-2",onClick:()=>P("Edit",t),children:"Edit Villa"}),e.jsx("button",{className:"bg-red-50 text-red-600 px-3 py-1 rounded-md",onClick:()=>P("Remove",t),children:"Remove Villa"})]})]}),e.jsxs("div",{className:"p-6 grid grid-cols-3 gap-6",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("img",{src:t.photos[0],alt:"Villa",className:"w-full h-40 object-cover rounded-lg"}),e.jsx("img",{src:t.photos[1],alt:"Villa",className:"w-full h-40 object-cover rounded-lg"})]})}),e.jsxs("div",{className:"col-span-2 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"ID"}),e.jsx("p",{className:"mt-1",children:t.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Property Type"}),e.jsx("p",{className:"mt-1",children:t.propertyType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Rooms"}),e.jsx("p",{className:"mt-1",children:t.rooms})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Max Guests"}),e.jsx("p",{className:"mt-1",children:t.maxGuests})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Base Price"}),e.jsx("p",{className:"mt-1",children:t.basePrice})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Location"}),e.jsx("p",{className:"mt-1",children:t.location})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Description"}),e.jsx("p",{className:"mt-1",children:t.description})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-500",children:"Amenities"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:t.amenities.map((s,l)=>e.jsx("span",{className:"bg-gray-100 px-2 py-1 rounded-full text-xs",children:s},l))})]})]})]})]},t.id)):e.jsx("div",{className:"p-6 text-center text-gray-500",children:e.jsx("p",{children:"No villas to display on this page"})})})]}),e.jsx("div",{className:"mt-4 overflow-x-auto",children:e.jsxs("div",{className:"flex justify-start md:justify-end gap-2 w-max min-w-full",children:[e.jsx("button",{className:`border border-gray-300 px-3 py-1 rounded ${n>1?"bg-white hover:bg-gray-50":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,onClick:R,disabled:n<=1,children:"Previous"}),Array.from({length:a==="villa-details"?totalVillaPages:u},(t,s)=>e.jsx("button",{className:`px-3 py-1 rounded ${n===s+1?"bg-blue-600 text-white":"bg-white border border-gray-300 hover:bg-gray-50"}`,onClick:()=>x(s+1),children:s+1},s+1)),e.jsx("button",{className:`border border-gray-300 px-3 py-1 rounded ${n<(a==="villa-details"?totalVillaPages:u)?"bg-white hover:bg-gray-50":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,onClick:T,disabled:n>=(a==="villa-details"?totalVillaPages:u),children:"Next"})]})})]})]})]})}export{z as default};
