import{b as n,G as g,j as t,H as d}from"./index-CHayuJmP.js";const H=()=>{const[A,D]=n.useState([]),[h,$]=n.useState(""),[b,M]=n.useState([]),[m,x]=n.useState(null),[R,y]=n.useState(!1),[N,f]=n.useState(null),[v,j]=n.useState(!1),[r,o]=n.useState({title:"",description:"",rating:5,newImages:[],deleteImages:[]});n.useEffect(()=>{u()},[]);const u=async()=>{try{const e=await g.get("/v1/reviews/admin/all");D(e.data.data)}catch(e){console.error("Failed to fetch reviews",e)}},L=async e=>{try{await g.put(`/v1/reviews/admin/edit/${e}`,{approve:!0}),u(),d.success("Review approved successfully")}catch(s){console.error("Approval failed",s),d.error("Approval failed")}},_=async e=>{if(window.confirm("Are you sure you want to delete this review?"))try{await g.delete(`/v1/reviews/admin/delete/${e}`),u(),d.success("Review deleted successfully")}catch(s){console.error("Delete failed",s),d.error("Failed to delete review")}},F=e=>{f(e._id),o({title:e.title||"",description:e.description||"",rating:e.rating||5,newImages:[],deleteImages:[]})},T=async e=>{try{j(!0);const s=new FormData;s.append("title",r.title),s.append("description",r.description),s.append("rating",r.rating),s.append("approve",!0),r.deleteImages.forEach(a=>{s.append("deleteImages[]",a)}),r.newImages.forEach(a=>{a instanceof File&&s.append("experienceImages",a)}),await g.put(`/v1/reviews/admin/edit/${e}`,s,{headers:{"Content-Type":"multipart/form-data"}}),f(null),o({title:"",description:"",rating:5,newImages:[],deleteImages:[]}),u(),d.success("Review updated successfully")}catch(s){console.error("Edit failed",s),d.error("Failed to save changes")}finally{j(!1)}},U=e=>{const s=Array.from(e.target.files);o(a=>({...a,newImages:[...a.newImages,...s]}))},O=e=>{o(s=>{const a=s.deleteImages.includes(e)?s.deleteImages.filter(i=>i!==e):[...s.deleteImages,e];return{...s,deleteImages:a}})},P=(e,s)=>{M(e),x(s),y(!0)},z=()=>{y(!1),x(null)},w=A.filter(e=>{var c,I,C,S,E,k;const s=((I=(c=e.villa)==null?void 0:c.villaName)==null?void 0:I.toLowerCase())||"",a=((S=(C=e.user)==null?void 0:C.firstName)==null?void 0:S.toLowerCase())||"",i=((k=(E=e.user)==null?void 0:E.lastName)==null?void 0:k.toLowerCase())||"",p=`${a} ${i}`.trim(),l=h.toLowerCase().trim();return s.includes(l)||a.includes(l)||i.includes(l)||p.includes(l)});return t.jsxs("div",{className:"min-h-screen bg-[#f9f9f9] p-6",children:[t.jsx("div",{className:"mb-8 text-center",children:t.jsx("h1",{className:"text-2xl md:text-4xl font-extrabold text-green-700 tracking-tight",children:"Experience Management"})}),t.jsx("input",{type:"text",placeholder:"Search by villa or user name...",className:"w-full max-w-md p-2 border border-gray-300 rounded-lg mb-6 shadow-sm focus:outline-none focus:ring-2 focus:ring-green-300",value:h,onChange:e=>$(e.target.value)}),t.jsx("div",{className:"grid grid-cols-2 gap-5",children:w.length>0?w.map(e=>{var s,a,i,p;return t.jsxs("div",{className:"bg-white p-5 rounded-2xl shadow-md border border-gray-200 transition hover:shadow-lg",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:((s=e.villa)==null?void 0:s.villaName)||"Villa Name"}),t.jsxs("span",{className:"text-sm text-gray-600",children:["Rating: ",e.rating," ⭐"]})]}),N===e._id?t.jsxs("div",{className:"space-y-2 mb-3",children:[t.jsx("input",{type:"text",value:r.title,onChange:l=>o({...r,title:l.target.value}),placeholder:"Title",className:"w-full p-2 border border-gray-300 rounded"}),t.jsx("textarea",{value:r.description,onChange:l=>o({...r,description:l.target.value}),placeholder:"Description",className:"w-full p-2 border border-gray-300 rounded"}),t.jsx("input",{type:"number",value:r.rating,onChange:l=>o({...r,rating:l.target.value}),max:"5",min:"1",className:"w-20 p-2 border border-gray-300 rounded"}),t.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:U,className:"block text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-100 file:text-green-700 hover:file:bg-green-200"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>T(e._id),disabled:v,className:"px-4 py-1 cursor-pointer rounded-full bg-green-600 text-white hover:bg-green-700 text-sm disabled:opacity-50",children:v?"Saving...":"Save"}),t.jsx("button",{onClick:()=>{f(null),o({title:"",description:"",rating:5,newImages:[],deleteImages:[]})},className:"px-4 py-1 cursor-pointer rounded-full bg-gray-400 text-white hover:bg-gray-500 text-sm",children:"Cancel"})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("h3",{className:"text-md font-semibold mb-1 text-gray-700",children:e.title}),t.jsx("p",{className:"text-gray-700 mb-3",children:e.description})]}),((a=e.experienceImages)==null?void 0:a.length)>0&&t.jsx("div",{className:"flex gap-3 overflow-x-auto mb-4",children:e.experienceImages.map((l,c)=>t.jsx("img",{src:l,alt:"villa review",onClick:()=>{N===e._id?O(l):P(e.experienceImages,c)},className:`h-24 w-32 object-cover rounded-lg border shadow hover:scale-105 transition duration-200 cursor-pointer ${r.deleteImages.includes(l)?"opacity-30 border-2 border-red-500":""}`},c))}),t.jsxs("p",{className:"text-sm text-gray-500 mb-3",children:["Submitted by:"," ",t.jsxs("span",{className:"font-medium",children:[(i=e.user)!=null&&i.firstName?e.user.firstName.charAt(0).toUpperCase()+e.user.firstName.slice(1).toLowerCase():"User"," ",(p=e.user)!=null&&p.lastName?e.user.lastName.charAt(0).toUpperCase()+e.user.lastName.slice(1).toLowerCase():""]})]}),t.jsxs("div",{className:"flex gap-3 flex-wrap",children:[!e.status||e.status!=="approved"?t.jsx("button",{onClick:()=>L(e._id),className:"px-4 py-1 cursor-pointer rounded-full bg-green-600 text-white hover:bg-green-700 text-sm",children:"Approve"}):t.jsx("span",{className:"text-green-600 text-sm font-semibold",children:"✅ Approved"}),t.jsx("button",{onClick:()=>F(e),className:"px-4 py-1 rounded-full cursor-pointer bg-yellow-500 text-white hover:bg-yellow-600 text-sm",children:"Edit"}),t.jsx("button",{onClick:()=>_(e._id),className:"px-4 py-1 cursor-pointer rounded-full bg-red-600 text-white hover:bg-red-700 text-sm",children:"Delete"})]})]},e._id)}):t.jsx("p",{className:"text-gray-600",children:"No reviews found."})}),R&&m!==null&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:t.jsxs("div",{className:"relative bg-white rounded-lg p-4 w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[t.jsx("button",{className:"absolute top-2 right-2 text-red-600 font-bold text-3xl sm:text-4xl",onClick:z,children:"×"}),t.jsx("img",{src:b[m],alt:`full-${m}`,className:"w-full max-h-[80vh] object-contain rounded mb-4"}),t.jsx("div",{className:"flex flex-wrap gap-3 justify-center",children:b.map((e,s)=>t.jsx("img",{src:e,alt:`modal-${s}`,className:`w-24 h-24 object-cover rounded cursor-pointer transition-all duration-200 ${s===m?"ring-4 ring-blue-400 scale-105":""}`,onClick:()=>x(s)},s))})]})})]})};export{H as default};
