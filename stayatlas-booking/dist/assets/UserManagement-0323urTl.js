import{b as i,j as e,G as g}from"./index-CHayuJmP.js";function C(){var b;const[u,x]=i.useState([]),[d,p]=i.useState(""),[t,c]=i.useState(null),[m,j]=i.useState(20);i.useEffect(()=>{(async()=>{try{const n=await g.get("/v1/users/users");x(n.data)}catch(n){console.error("Error fetching users:",n)}})()},[]);const N=async s=>{var r;let n="";if(!((r=u.find(a=>a._id===s))!=null&&r.isBanned)&&(n=prompt("Enter reason for banning the user:"),!n))return alert("Ban reason is required!");try{const a=await g.patch(`/v1/users/users/${s}/toggle-ban`,{reason:n});x(l=>l.map(h=>h._id===s?{...h,isBanned:!h.isBanned}:h)),(t==null?void 0:t._id)===s&&c(l=>({...l,isBanned:!l.isBanned,banReason:l.isBanned?"":n,bannedAt:l.isBanned?null:new Date().toISOString()}))}catch(a){console.error("Failed to toggle ban:",a)}},o=u.filter(s=>{var n,r;return((n=`${s.firstName} ${s.lastName}`)==null?void 0:n.toLowerCase().includes(d.toLowerCase()))||((r=s.email)==null?void 0:r.toLowerCase().includes(d.toLowerCase()))||(s.bookingHistory||[]).some(a=>{var l;return(l=a==null?void 0:a.room)==null?void 0:l.toLowerCase().includes(d.toLowerCase())})}),f=async s=>{if(confirm("Are you sure you want to permanently delete this user?"))try{await g.delete(`/v1/users/users/${s}`),x(r=>r.filter(a=>a._id!==s)),c(null),alert("User deleted successfully!")}catch(r){console.error("Error deleting user:",r),alert("Failed to delete user.")}},y=()=>{j(s=>s+20)},w=()=>{j(20)},v=o.slice(0,m);return e.jsxs("div",{className:"p-10 bg-white min-h-screen text-gray-800 relative",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold text-green-700 tracking-tight",children:"User Management"}),e.jsxs("p",{className:"mt-2 text-gray-600 text-base md:text-lg font-medium",children:["Total Users:"," ",e.jsx("span",{className:"font-semibold text-gray-900",children:o.length})]})]}),e.jsx("div",{className:"flex justify-end mb-5",children:e.jsx("input",{type:"text",placeholder:"Search users...",className:"px-5 py-3 w-80 border border-gray-500 rounded-md text-base",value:d,onChange:s=>p(s.target.value)})}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:v.map(s=>{var n;return e.jsxs("div",{onClick:()=>c(s),className:`cursor-pointer border border-gray-400 hover:border-blue-500 p-4 rounded-lg bg-gray-100 shadow-sm transition-all ${(t==null?void 0:t._id)===s._id?"border-blue-500 bg-blue-50":""}`,children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",s.firstName," ",s.lastName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:s.isBanned?"text-red-500":"text-green-600",children:s.isBanned?"Banned":"Active"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Bookings:"})," ",((n=s.bookingHistory)==null?void 0:n.length)||0]})]},s._id)})}),o.length>20&&e.jsxs("div",{className:"flex justify-center mt-6 gap-4",children:[m<o.length&&e.jsx("button",{onClick:y,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Show More"}),m>20&&e.jsx("button",{onClick:w,className:"px-6 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"Show Less"})]}),t&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex justify-end transition-opacity duration-300",children:e.jsxs("div",{className:"w-full sm:w-[80%] md:w-[60%] lg:w-[50%] bg-white h-full shadow-lg p-6 overflow-y-auto relative transform translate-x-0 transition-transform duration-300",children:[e.jsx("button",{onClick:()=>c(null),className:"absolute top-4 right-4 text-gray-600 hover:text-black text-xl",children:"âœ–"}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"User Details"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",t.firstName," ",t.lastName]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Email:"})," ",t.email]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:t.isBanned?"text-red-500":"text-green-600",children:t.isBanned?"Banned":"Active"})]}),t.isBanned&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Ban Reason:"})," ",t.banReason||"Not specified"]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("strong",{children:"Banned At:"})," ",t.bannedAt?new Date(t.bannedAt).toLocaleString():"N/A"]})]}),e.jsxs("div",{className:"flex gap-3 mt-2",children:[e.jsx("button",{onClick:()=>N(t._id),className:`px-4 py-2 rounded ${t.isBanned?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"} text-white`,children:t.isBanned?"Unban User":"Ban User"}),t.isBanned&&e.jsx("button",{onClick:()=>f(t._id),className:"px-4 py-2 rounded bg-gray-800 hover:bg-black text-white",children:"Delete User"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Booking History"}),((b=t.bookingHistory)==null?void 0:b.length)>0?e.jsx("div",{className:"space-y-4",children:t.bookingHistory.map((s,n)=>{var r;return e.jsxs("div",{className:"border border-gray-200 rounded-md p-4 shadow-sm bg-white",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Villa:"})," ",((r=s.villa)==null?void 0:r.villaName)||"Villa Name Not Found"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Guests:"})," Adults: ",s.guests.adults,", Children: ",s.guests.children,", Pets:"," ",s.guests.pets]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dates:"})," ",new Date(s.checkIn).toLocaleDateString()," to"," ",new Date(s.checkOut).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Duration:"})," ",s.nights," nights"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:s.status==="Pending"?"text-yellow-500":s.status==="Confirmed"?"text-green-600":s.status==="Cancelled"?"text-red-500":s.status==="Completed"?"text-blue-500":"text-gray-600",children:s.status})]})]},n)})}):e.jsx("p",{className:"text-gray-500",children:"No booking history found"})]})]})})]})}export{C as default};
